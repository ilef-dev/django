{% extends "base.html" %}

{% block title %}Новости{% endblock %}
{% block content %}
    <h1>Новости</h1>

    <div class="category-buttons">
        <a href="{% url 'news_list' %}" class="{% if not category %}active{% endif %}">Все категории</a>
        {% for cat in categories %}
            <a href="?category={{ cat.id }}" 
               class="{% if category and category.id == cat.id %}active{% endif %}">{{ cat.name }}</a>
        {% endfor %}
    </div>

    <div class="tag-buttons">
        <a href="{% url 'news_list' %}" class="{% if not selected_tags %}active{% endif %}">Сбросить</a>
        <form method="get">
            {% if category %}
                <input type="hidden" name="category" value="{{ category.id }}">
            {% endif %}
            {% for t in tags %}
                <label>
                    <input type="checkbox" name="tags" value="{{ t.id }}" 
                           {% if t in selected_tags %}checked{% endif %}> {{ t.name }}
                </label><br>
            {% endfor %}
            <button type="submit">Применить</button>
        </form>
    </div>

    {% if category %}
        <h2>Новости в категории: {{ category.name }}</h2>
    {% endif %}

    {% if selected_tags %}
        <h2>Новости с тегами: 
            {% for tag in selected_tags %}
                <span>{{ tag.name }}</span>{% if not forloop.last %}, {% endif %}
            {% endfor %}
        </h2>
    {% endif %}

    {% for news_item in page_obj %}
        <div>
            <h3>{{ news_item.title }}</h3>
            <p>{{ news_item.description }}</p>
            {% if news_item.image %}
                <img src="{{ news_item.image.url }}" alt="{{ news_item.title }}" width="300">
            {% endif %}
            <p>Дата: {{ news_item.created_at }}</p>
        </div>
    {% endfor %}

    <div>
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?{% if category %}category={{ category.id }}{% endif %}{% if selected_tags %}&tags={{ selected_tags|join:"&tags=" }}{% endif %}&page=1">&laquo; Первая</a>
                <a href="?{% if category %}category={{ category.id }}{% endif %}{% if selected_tags %}&tags={{ selected_tags|join:"&tags=" }}{% endif %}&page={{ page_obj.previous_page_number }}">Предыдущая</a>
            {% endif %}

            <span class="current">
                Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}.
            </span>

            {% if page_obj.has_next %}
                <a href="?{% if category %}category={{ category.id }}{% endif %}{% if selected_tags %}&tags={{ selected_tags|join:"&tags=" }}{% endif %}&page={{ page_obj.next_page_number }}">Следующая</a>
                <a href="?{% if category %}category={{ category.id }}{% endif %}{% if selected_tags %}&tags={{ selected_tags|join:"&tags=" }}{% endif %}&page={{ page_obj.paginator.num_pages }}">Последняя &raquo;</a>
            {% endif %}
        </span>
    </div>
{% endblock %}
